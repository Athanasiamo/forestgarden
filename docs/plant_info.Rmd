---
title: "Forest garden plants"
description: |
  An overview of our wishes
---


The information on this page is a combination of manually gathered information about the various plants and automatic scrape of the webpages of [efferus](www.efferus.no). 
The majority of the information is taken from [efferus](www.efferus.no), which is a great resource of information in Norwegian about plants and trees that can be grown in Norway, with particular focus on forest gardens and permaculture.

All information about height and width are approximations. 
The size of plants may vary substantially between different grow conditions.
Height and width here are mainly given as maxima of full potential, and they might grow smaller in your area. 

In the case of trees that are grafted, the sizes of these depend on the plant they are grafted on to. 
In such cases, the height and width are a product of the main plant, not the fruiting plant. 
Since our garden is not too large, we have chosen these trees to be small, despite the possibility of having them larger.


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(tidyverse)
library(reactable)
library(shiny)
library(htmltools)
```

```{r colours}
green <- "#a6cfba"
green_dark <- "#637c6f"
red <- "#df8a8b"
red_dark <- "#792425"
yellow <- "#ece8cf"
yellow_dark <- "#d0c789"

rdylgr <- function(x) rgb(colorRamp(c(red, yellow, green))(x), maxColorValue = 255)
rdyl <- function(x) rgb(colorRamp(c(red_dark, yellow_dark))(x), maxColorValue = 255)
ylgr <- function(x) rgb(colorRamp(c(yellow_dark, green_dark))(x), maxColorValue = 255)
rd <- function(x) rgb(colorRamp(c(red, red_dark))(x), maxColorValue = 255)
gr <- function(x) rgb(colorRamp(c(green, green_dark))(x), maxColorValue = 255)
yl <- function(x) rgb(colorRamp(c(yellow, yellow_dark))(x), maxColorValue = 255)


normalize <- function(x, y, pal){
  k <- (x - min(y, na.rm = TRUE)) / (max(y, na.rm = TRUE) - min(y, na.rm = TRUE))
  na_indx <- which(is.na(x))
  k[na_indx] <- 0
  j <- pal(k)
  j[na_indx] <- "#ffffff"
  j
}
```


```{r icons}
# See the ?tippy documentation for how to customize tooltips
with_tooltip <- function(value, tooltip, ...) {
  div(style = "text-decoration: underline; text-decoration-style: dotted; cursor: help",
      tippy::tippy(value, tooltip, ...))
}

get_icon <- function(icon, colour = "grey", size = 2, lib = "font-awesome") {
  k <- htmltools::tagAppendAttributes(
    shiny::icon(icon, lib = lib),
    style = paste0("color:", colour, "; text-align: center;" ),
    "aria-hidden" = "true"
  )
  if(lib == "font-awesome"){
    k$attribs$class <- sprintf("%s fa-%sx", k$attribs$class, size)
  }else{
    k$attribs$`aria-hidden` <- NULL
  }
  k
}

rating <- function(rating, colour = yellow, max_rating = 5, ...) {
  if(is.na(rating)) rating = 0
  rounded_rating <- floor(rating + 0.5)  # always round up
  stars <- lapply(seq_len(max_rating), function(i) {
    if (i <= rounded_rating){
      get_icon(colour = colour, ...)
    }else{
      get_icon(colour = "#d2d2d2", ...)
    }
  })
  label <- sprintf("%s out of %s", rating, max_rating)
  div(title = label, "aria-label" = label, role = "img", stars)
}

get_value <- function(x, func = max){
  k <- str_split(x, "-")
  k <- sapply(k, unique)
  j <- suppressWarnings(sapply(k, as.numeric))
  j <- sapply(j, mean)
  j <- unname(j)
  # j[is.na(j)] <- 0
  j
}

sticky_style <- function(left = TRUE) {
  style <- list(position = "sticky", background = "#fff", zIndex = 1)
  if (left) {
    style <- c(style, list(left = 0, borderRight = "1px solid #eee"))
  } else {
    style <- c(style, list(right = 0, borderLeft = "1px solid #eee"))
  }
  style
}

.get_nitro <- function(x){
  case_when(
    x == "high" ~ 1L,
    x == "medium" ~ 2L,
    x == "low" ~ 3L,
    TRUE ~ NA_integer_
  )
}
```


```{r get-data}
source(here::here("R/scrape_efferus_table.R"))
data_orig <- data

data <- data_orig %>% 
  select(-frobehandling, -fruktbarhet, 
         -ektotrof, -distance, -soil_type) %>% 
  rename(
    herdighet = herdighetssone,
    farer = kjente_farer,
    type = bladfellende_eviggronn,
    jordekkende = jorddekkende_egenskap,
    ytelse = ytelsesevne,
    nitrogen = needs_nitrogen
  ) %>% 
  mutate(
    herdighet = get_value(herdighet, max),
    jordekkende = get_value(jordekkende, mean),
    spiselig = get_value(spiselig),
    medisinsk = get_value(medisinsk),
    ytelse = get_value(ytelse),
    height = get_value(height),
    width = get_value(width)
  ) %>%
  relocate(intention, .before = herdighet) %>% 
  relocate(height, width, nitrogen, singular, windbreaker,
           systems, mineral_type, .after = herdighet)
```


```{r "plant-table"}
reactable(
  data, 
  compact = TRUE,
  filterable = TRUE,
  pagination = FALSE,
  columns = list(
    familie = colDef(show = FALSE),
    latinsk_navn = colDef(show = FALSE),
    img = colDef(show = FALSE), 
    url = colDef(show = FALSE), 
    navn = colDef(
      minWidth = 200,
      cell = function(value, index){
        species <- data$familie[index]
        species <- if (!is.na(species)) gsub("efamilien|efamilie|familien|familie", "", species) else "Unknown"
        
        latin <- data$latinsk_navn[index]
        latin <- if (!is.na(latin)) latin else "Unknown"
        
        img_url <- data$img[index]
        img_url <- if (!is.na(img_url)){
          sprintf("http://www.efferus.no/%s", img_url) 
        }else{
          "https://comps.canstockphoto.com/question-mark-vines-pot-illustration-drawing_csp72272295.jpg"
        }
        img_url <- img(src = img_url, alt = value)
        
        tagList(
          div(style = list(fontWeight = 600), a(value, href=data$url[index])),
          div(class = "plant-image", img_url),
          div(style = list(fontSize = 12), species),
          div(style = list(fontSize = 12, fontStyle = "italic", color = "#727272"), latin)
        )
      }
    ),
    herdighet = colDef(
      align = "center",
      class = "tag",
      minWidth = 80,
      style = function(value) {
        list(
          background = normalize(value, data$herdighet, rdylgr))
      }),
    nitrogen = colDef(
      align = "center",
      class = "tag",
      minWidth = 90,
      cell = function(value){
        x <- .get_nitro(value)
        div(title = x, ifelse(is.na(value), "", value))
      },
      style = function(value) {
        list(
          background = normalize(.get_nitro(value),
                                 .get_nitro(data$nitrogen), rdylgr))
      }),
    intention = colDef(
      minWidth = 110
    ),
    windbreaker = colDef(
      align = "center",
      minWidth = 120,
      cell = function(value) 
        if(!is.na(value)){
          get_icon("wind", "#388a35")
        }
    ),
    spiselig = colDef(
      align = "center",
      cell = function(value) rating(
        rating = value, 
        colour = normalize(value, data$spiselig, ylgr), 
        icon = "apple-alt", size = 1,
        max_rating = max(data$spiselig, na.rm = TRUE))
    ),
    medisinsk = colDef(
      minWidth = 120,
      align = "center",
      cell = function(value) rating(
        rating = value, 
        colour = normalize(value, data$medisinsk, rdyl), 
        icon = "hand-holding-medical", size = 1,
        max_rating = max(data$medisinsk, na.rm = TRUE))
    ),
    jordekkende = colDef(
      minWidth = 120,
      align = "center",
      cell = function(value) rating(
        rating = value, 
        colour = normalize(value, data$jordekkende, gr), 
        icon = "spa", size = 1,
        max_rating = max(data$jordekkende, na.rm = TRUE))
    ),
    ytelse = colDef(
      cell = function(value) rating(
        rating = value, 
        colour = normalize(value, data$ytelse, ylgr), 
        icon = "certificate", size = 1,
        max_rating = max(data$ytelse, na.rm = TRUE))
    ),
    height = colDef(
      align = "center",
      minWidth = 65,
      class = "tag",
      style = function(value) {
        list(
          background = normalize(value, data$height, rdylgr))
      }),
    width = colDef(
      align = "center",
      minWidth = 65,
      class = "tag",
      style = function(value) {
        list(
          background = normalize(value, data$width, rdylgr))
      }),
    skygge_sol_preferanse = colDef(
      align = "center",
      cell = function(value) 
        switch(value,
               "Sol" = get_icon("sun", yellow_dark),
               "Sol-lettskygge" = get_icon("cloud-sun", "#a2a2a2"),
               "Sol-Sol-dypskygge" = get_icon("cloud", "#626262")
        )
    ),
    skygge_sol_toleranse = colDef(
      align = "center",
      cell = function(value)
        switch(value,
               "Sol" = get_icon("sun", yellow_dark),
               "Sol-lettskygge" = get_icon("cloud-sun", "#a2a2a2"),
               "Sol-Sol-dypskygge" = get_icon("cloud", "#626262")
        )
    ),
    type = colDef(
      align = "center",
      cell = function(value) { 
        x <- case_when(
          grepl("Blad.*Evig|Evig.*Blad", value) ~ "tree,leaf",
          grepl("Bladfellende", value) ~ "leaf",
          grepl("Evig", value) ~ "tree", 
          TRUE ~ NA_character_
        )
        x <- str_split(x, ",")[[1]]
        x <- lapply(x, get_icon, colour = green)
        div(title = value, "aria-label" = value, role = "img", x)
      }),
    farer = colDef(
      align = "center", 
      class = "tag",
      style = function(value) {
        list(
          background = if(is.na(value) | value == "Ingen kjente") green else red)
      },
      cell = function(value){
        if(is.na(value) | value == "Ingen kjente"){
          with_tooltip("Nei", "Ingen kjente farer")
        }else{
          with_tooltip("Ja", value)
        }
      }
    ),
    notes = colDef(
      align = "center", 
      class = "tag",
      style = function(value) {
        list(
          background = if(!is.na(value)) yellow_dark else yellow
        )},
      cell = function(value){
        if(is.na(value)){
          with_tooltip("None", "No comments")
        }else{
          with_tooltip("See note", value)
        }
      }
    )
  ),
  
  defaultSorted = list(intention = "asc"),
  rowStyle = JS("
    function(rowInfo, state) {
      // Add horizontal separators between groups when sorting by intention
      var firstSorted = state.sorted[0]
      if (firstSorted && firstSorted.id === 'intention') {
        var nextRow = state.pageRows[rowInfo.viewIndex + 1]
        if (nextRow && rowInfo.row['intention'] !== nextRow['intention']) {
          // Use box-shadow to add a 2px border without taking extra space
          return { boxShadow: 'inset 0 -4px 0 rgba(0, 0, 0, 0.1)' }
        }
      }
    }
  "),
  defaultColDef = colDef(
    style = JS("function(rowInfo, colInfo, state) {
      // Highlight sorted columns
      for (var i = 0; i < state.sorted.length; i++) {
        if (state.sorted[i].id === colInfo.id) {
          return { background: 'rgba(0, 0, 0, 0.03)' }
        }
      }
    }")
  )
)
```





